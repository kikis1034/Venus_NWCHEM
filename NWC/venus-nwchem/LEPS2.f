      SUBROUTINE LEPS2(NL)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      INCLUDE 'SIZES'
      COMMON/QPDOT/Q(NDA3),PDOT(NDA3)
      COMMON/COORS/R(NDA*(NDA+1)/2),THETA(ND03),ALPHA(ND04),CTAU(ND06),
     *GR(ND08,5),TT(ND09,6),DANG(ND13I)
      COMMON/LEPSB/RLZS1(100),RLZS2(100),RLZS3(100),RLZT1(100),
     *RLZT2(100),RLZT3(100),BLS1(100),BLS2(100),BLS3(100),BLT1(100),
     *BLT2(100),BLT3(100),DLS1(100),DLS2(100),DLS3(100),DLT1(100),
     *DLT2(100),DLT3(100),VLEPSB(100),N19J1(100),N19K1(100),
     *N19J2(100),N19K2(100),N19J3(100),N19K3(100)
      COMMON/FORCES/NATOMS,I3N,NST,NM,NB,NA,NLJ,NTAU,NEXP,NGHOST,NTET,
     *NVRR,NVRT,NVTT,NANG,NAXT,NSN2,NRYD,NHFD,NLEPSA,NLEPSB,NDMBE,
     *NRAX,NONB,NMO,NCRCO6
C
C         CALCULATE INDICES FOR COORDINATES
C
      J13=3*N19J1(NL)
      J12=J13-1
      J11=J12-1
      K13=3*N19K1(NL)
      K12=K13-1
      K11=K12-1
      J23=3*N19J2(NL)
      J22=J23-1
      J21=J22-1
      K23=3*N19K2(NL)
      K22=K23-1
      K21=K22-1
      J33=3*N19J3(NL)
      J32=J33-1
      J31=J32-1
      K33=3*N19K3(NL)
      K32=K33-1
      K31=K32-1
C
C         CALCULATE INDEX FOR R
C
      JK1=(N19J1(NL)-1)*(2*NATOMS-N19J1(NL))/2+N19K1(NL)-N19J1(NL)
      JK2=(N19J2(NL)-1)*(2*NATOMS-N19J2(NL))/2+N19K2(NL)-N19J2(NL)
      JK3=(N19J3(NL)-1)*(2*NATOMS-N19J3(NL))/2+N19K3(NL)-N19J3(NL)
C
C         CALCULATE RELATIVE COORDINATES AND R
C
      T11=Q(K11)-Q(J11)
      T12=Q(K12)-Q(J12)
      T13=Q(K13)-Q(J13)
      T21=Q(K21)-Q(J21)
      T22=Q(K22)-Q(J22)
      T23=Q(K23)-Q(J23)
      T31=Q(K31)-Q(J31)
      T32=Q(K32)-Q(J32)
      T33=Q(K33)-Q(J33)
      R(JK1)=SQRT(T11*T11+T12*T12+T13*T13)
      R(JK2)=SQRT(T21*T21+T22*T22+T23*T23)
      R(JK3)=SQRT(T31*T31+T32*T32+T33*T33)
C
C         CALCULATE THE POTENTIAL
C
      TERM1=EXP(-BLS1(NL)*(R(JK1)-RLZS1(NL)))
      TERM2=EXP(-BLS2(NL)*(R(JK2)-RLZS2(NL)))
      TERM3=EXP(-BLS3(NL)*(R(JK3)-RLZS3(NL)))
      TERM4=EXP(-BLT1(NL)*(R(JK1)-RLZT1(NL)))
      TERM5=EXP(-BLT2(NL)*(R(JK2)-RLZT2(NL)))
      TERM6=EXP(-BLT3(NL)*(R(JK3)-RLZT3(NL)))
      VM1=DLS1(NL)*(TERM1*TERM1-2.0D0*TERM1)
      VM2=DLS2(NL)*(TERM2*TERM2-2.0D0*TERM2)
      VM3=DLS3(NL)*(TERM3*TERM3-2.0D0*TERM3)
      VAM1=DLT1(NL)*(TERM4*TERM4+2.0D0*TERM4)
      VAM2=DLT2(NL)*(TERM5*TERM5+2.0D0*TERM5)
      VAM3=DLT3(NL)*(TERM6*TERM6+2.0D0*TERM6)
      VQ1=(VM1+VAM1)*0.5D0
      VQ2=(VM2+VAM2)*0.5D0
      VQ3=(VM3+VAM3)*0.5D0
      VJ1=(VM1-VAM1)*0.5D0
      VJ2=(VM2-VAM2)*0.5D0
      VJ3=(VM3-VAM3)*0.5D0
      TERMJ=SQRT(VJ1**2+VJ2**2+VJ3**2-VJ1*VJ2-VJ2*VJ3-VJ3*VJ1)
C
      VLEPSB(NL)=VQ1+VQ2+VQ3-TERMJ
C
C         CALCULATE (DV/DQ)'S
C
      DVMDR1=2.0D0*DLS1(NL)*(1.0D0-TERM1)*BLS1(NL)*TERM1/R(JK1)
      DVMDR2=2.0D0*DLS2(NL)*(1.0D0-TERM2)*BLS2(NL)*TERM2/R(JK2)
      DVMDR3=2.0D0*DLS3(NL)*(1.0D0-TERM3)*BLS3(NL)*TERM3/R(JK3)
      DVAMDR1=-2.0D0*DLT1(NL)*(1.0D0+TERM4)*BLT1(NL)*TERM4/R(JK1)
      DVAMDR2=-2.0D0*DLT2(NL)*(1.0D0+TERM5)*BLT2(NL)*TERM5/R(JK2)
      DVAMDR3=-2.0D0*DLT3(NL)*(1.0D0+TERM6)*BLT3(NL)*TERM6/R(JK3)
      DQDR1=(DVMDR1+DVAMDR1)*0.5D0
      DQDR2=(DVMDR2+DVAMDR2)*0.5D0
      DQDR3=(DVMDR3+DVAMDR3)*0.5D0
      DJDR1=(DVMDR1-DVAMDR1)*0.5D0
      DJDR2=(DVMDR2-DVAMDR2)*0.5D0
      DJDR3=(DVMDR3-DVAMDR3)*0.5D0
      DVDJ1=-0.5D0*(2.0D0*VJ1-VJ2-VJ3)/TERMJ
      DVDJ2=-0.5D0*(2.0D0*VJ2-VJ3-VJ1)/TERMJ
      DVDJ3=-0.5D0*(2.0D0*VJ3-VJ1-VJ2)/TERMJ
      DVDR1=DQDR1+DVDJ1*DJDR1
      DVDR2=DQDR2+DVDJ2*DJDR2
      DVDR3=DQDR3+DVDJ3*DJDR3
C
      DUM2=T11*DVDR1
      PDOT(K11)=PDOT(K11)+DUM2
      PDOT(J11)=PDOT(J11)-DUM2
      DUM2=T12*DVDR1
      PDOT(K12)=PDOT(K12)+DUM2
      PDOT(J12)=PDOT(J12)-DUM2
      DUM2=T13*DVDR1
      PDOT(K13)=PDOT(K13)+DUM2
      PDOT(J13)=PDOT(J13)-DUM2
C
      DUM2=T21*DVDR2
      PDOT(K21)=PDOT(K21)+DUM2
      PDOT(J21)=PDOT(J21)-DUM2
      DUM2=T22*DVDR2
      PDOT(K22)=PDOT(K22)+DUM2
      PDOT(J22)=PDOT(J22)-DUM2
      DUM2=T23*DVDR2
      PDOT(K23)=PDOT(K23)+DUM2
      PDOT(J23)=PDOT(J23)-DUM2
C
      DUM2=T31*DVDR3
      PDOT(K31)=PDOT(K31)+DUM2
      PDOT(J31)=PDOT(J31)-DUM2
      DUM2=T32*DVDR3
      PDOT(K32)=PDOT(K32)+DUM2
      PDOT(J32)=PDOT(J32)-DUM2
      DUM2=T33*DVDR3
      PDOT(K33)=PDOT(K33)+DUM2
      PDOT(J33)=PDOT(J33)-DUM2
C
      RETURN
      END
